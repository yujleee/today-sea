(()=>{"use strict";const e={setLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))},getLocalStorage:e=>JSON.parse(localStorage.getItem(e))};new function(){const t=document.querySelector(".input-search"),n=t.parentNode,r=document.querySelector(".result-list");let a={};const s=[];this.searchCount=-1,this.searchMaxCount=0,(async()=>{await fetch("../assets/beachData.json").then((e=>e.json())).then((e=>(a=Object.values(e),a))).then((e=>{for(const[t,n]of Object.entries(e))s[t]=n.name;return s})).catch((e=>console.error(e)))})();const o=()=>{const e=t.value;let n=[];""!==e&&(n=s.filter((t=>t.toLowerCase().startsWith(e))).map((e=>`<li>${e}</li>`)).join("")),r.innerHTML=n,this.searchMaxCount=r.childElementCount},i=r=>{const s=1===t.value.length?r.target.innerText:t.value;let o=1;for(const[e,t]of Object.entries(a))t.name===s&&(o=t["beach-num"]);t.value=s;const i={num:o,name:s};e.setLocalStorage("beachInfo",i),n.submit()},c=e=>{this.searchCount>=this.searchMaxCount?this.searchCount=-1:(this.searchCount>this.searchMaxCount||this.searchCount<0)&&(this.searchCount=this.searchMaxCount);const n=r.childNodes[this.searchCount];switch(e.key){case"ArrowUp":this.searchCount-=1;break;case"ArrowDown":this.searchCount+=1;break;case"Enter":t.value=n.innerText,i()}n.classList.toggle("is-active")};t.addEventListener("keyup",(e=>{"backspace"!==e.key&&(r.parentNode.classList.add("is-active"),o()),"ArrowUp"!==e.key&&"ArrowDown"!==e.key||c(e)})),t.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.preventDefault(),c(e))})),r.addEventListener("click",(e=>{i(e)}))};const t=[{img_id:1,name:"clear",img:"../assets/images/clear.png"},{img_id:4,name:"cloud",img:"../assets/images/cloud.png"},{img_id:3,name:"fewCloud",img:"../assets/images/few-cloud.png"},{img_id:2,name:"rain",img:"../assets/images/rain.png"},{img_id:6,name:"lightRain",img:"../assets/images/light-Rain.png"},{img_id:8,name:"snow",img:"../assets/images/snow.png"},{img_id:5,name:"night",img:"../assets/images/night.png"}],n=Number(e.getLocalStorage("currentTime").time),r=e.getLocalStorage("beachInfo").name,a=e.getLocalStorage("currentTime").time,s=document.querySelector(".beach-info-top"),o=document.querySelector(".info-area"),i={45:"북-북동",90:"북동-동",135:"동-남동",180:"남동-남",225:"남-남서",270:"남서-서",315:"남-북서",360:"북서-북"},c=document.querySelector(".info-area"),u=document.querySelector(".info-area"),l=e.getLocalStorage("currentTime").time,m=["ET1","FT1","ET2","FT2"],g="https://apis.data.go.kr/1360000/BeachInfoservice",d="JgOTEFegmT85gM1vQ7XNalEJFJb0gusFB26pkZkBameKaU3B5WlTltcyt6xWvGR8aNvLvw7Jw6gqnQSiMm6KgQ%3D%3D",h=[2,5,8,11,14,17,20,23],y=e.getLocalStorage("beachInfo").num,S={},T=()=>{fetch(`${g}/getVilageFcstBeach?serviceKey=${d}&dataType=JSON&base_date=${S.date}&base_time=${S.time}&beach_num=${y}&numOfRows=20`).then((e=>e.json())).then((e=>{document.querySelector(".loading").classList.remove("before-load"),(e=>{const c=(e=>{const t={};return e.item.forEach((e=>{t[e.category]=e.fcstValue})),t})(e.response.body.items);s.querySelector(".beach-name").innerText=r,s.querySelector(".base-time").innerText=`오늘 ${a.slice(0,2)}시 기준`,s.querySelector(".weather-img img").setAttribute("src",((e,r)=>{let a="";return n>=2e3?t.find((e=>"night"===e.name)).img:(0===Number(r)&&(a=t.find((t=>t.img_id===Number(e))).img),Number(r)>=1&&(a=t.find((e=>e.img_id===Number(r)+1)).img),a)})(c.SKY,c.PTY)),s.querySelector(".current-temp").innerText=`${c.TMP}°`,o.querySelector(".humidty").innerText=`${c.REH}%`,o.querySelector(".wave").innerText=`${c.WAV}`,o.querySelector(".wind-speed").innerText=`${c.WSD}`,o.querySelector(".wind-direction").innerText=`${(e=>{let t="";for(const[n,r]of Object.entries(i))e<=n&&(t=r);return t})(c.VEC)}`})(e)})).catch((e=>{console.error(e)}))};(async()=>{await(async()=>{const e=new Date,t=e.getFullYear(),n=e.toLocaleString("ko-KO",{month:"2-digit"}).slice(0,2),r=e.toLocaleString("ko-KO",{day:"2-digit"}).slice(0,2);return S.date=`${t}${n}${r}`,S.time=(e=>{const t=h.find((t=>e<=t));return t<10?`0${t}00`:`${t}00`})(e.getHours()),S})(),e.setLocalStorage("currentTime",{date:S.date,time:S.time}),T(),fetch(`${g}/getSunInfoBeach?serviceKey=${d}&dataType=JSON&base_date=${S.date}&beach_num=${y}`).then((e=>e.json())).then((e=>(e=>{const t={sunrise:":"!==(n=e.response.body.items).item[0].sunrise?n.item[0].sunrise:"정보없음",sunset:":"!==n.item[0].sunset?n.item[0].sunset:"정보없음"};var n;c.querySelector(".sunrise").innerText=t.sunrise,c.querySelector(".sunset").innerText=t.sunset})(e))).catch((e=>{console.error(e),window.location.replace("./error.html")})),fetch(`${g}/getTideInfoBeach?serviceKey=${d}&dataType=JSON&base_date=${S.date}&beach_num=${y}`).then((e=>e.json())).then((e=>{(e=>{const t=(e=>{const t=Object.values(e),n={};return t[0].forEach((e=>{"-"===e.tiType&&m.forEach((e=>n[e]="정보없음")),n[e.tiType]=e.tiTime})),n})(e.response.body.items);let n="",r="";Number(l.slice(0,2))<12?(n=t.ET1,r=t.FT1):(n=t.ET2,r=t.FT2),u.querySelector(".ebb-tide").innerText=`${n}`,u.querySelector(".flood-tide").innerText=`${r}`})(e),document.querySelector(".loading").addEventListener("transitionend",(e=>{console.log(e.currentTarget),console.log("loading end"),document.body.removeChild(e.currentTarget)}))})).catch((e=>{console.error(e),window.location.replace("./error.html")}))})()})();